<!-- Tools bar (report issue, forward ...) -->
<div class="d-sm-flex justify-content-between align-items-start">
  <div>
    <h4 class="card-title card-title-dash">Prescription</h4>
    <p class="card-subtitle card-subtitle-dash">View Prescriptions</p>
  </div>

  <div class="btn-wrapper">
    <a href="#" class="btn btn-outline-primary align-items-center"><i class="fa fa-paper-plane"></i> Forward</a>
    <a href="#" class="btn btn-outline-primary align-items-center"><i class="icon-printer"></i> Export PDF</a>
    <span class="btn btn-primary text-white align-items-center" (click)="onClickNewPrescription()"> <i class="fa fa-qrcode" aria-hidden="true"></i> New Prescription </span>
    <a href="#" class="btn btn-primary text-white align-items-center" [routerLink]="['/', 'eScript']" routerLinkActive="active">
      <i class="fa fa-qrcode" aria-hidden="true"></i> eScript (electronic prescription)
    </a>
    <a href="#" class="btn btn-danger text-white align-items-center" [routerLink]="['/', 'report-issue-csv']" style="border-color: red">
      <i class="fa fa-flag" aria-hidden="true"></i> Report an issue
    </a>
  </div>
</div>
<!-- content -->
<div class="wizard-container" style="height: 490px; overflow-y: auto">
  <!-- If no prescription is selected: Search + table part -->
  <div [className]="selectedPrescription != undefined && 'd-none'">
    <!-- Search prescription -->
    <div class="form-group d-flex gap-3 col-lg-5 mx-auto mt-2 mb-0 align-content-center align-items-center">
      <input [disabled]="isLoading" type="text" class="form-control form-control-sm" name="" id="" aria-describedby="helpId" [(ngModel)]="searchTerm" placeholder="Enter Id or Patient Name" />
      <input [disabled]="isLoading" name="" id="" class="btn btn-outline-primary m-0" type="button" value="Search" />
      <i class="fa fa-refresh" id="refresh-icon" aria-hidden="true" title="Refresh" (click)="onClickRefresh()"></i>
    </div>
    <!-- Search result : Table of prescriptions -->
    @if(isLoading == false){
    <table class="table table-responsive">
      <thead>
        <tr id="table-head-row">
          <th class="col-1">Medical Record ID</th>
          <th class="col-1">Prescription ID</th>
          <th class="col-3">Patient Name</th>
          <th class="col-2">Patient Status</th>
          <th class="col-2">Doctor Name</th>
          <th class="col-2">Date</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let register of registrations; let i = index">
          @if(register.prescriptions && register.prescriptions.length>0){
          <tr *ngFor="let prescription of register.prescriptions" (click)="onClickPrescription(prescription)">
            <td class="col-1">{{ register.id.slice(-10) + "..." }}</td>
            <td class="col-1">{{ prescription.id.slice(-10) + "..." }}</td>
            <td class="col-3">{{ register.patient.firstName + " " + register.patient.lastName }}</td>
            <td class="col-2">{{ getStatus(register) }}</td>
            <td class="col-2">{{ "After AZURE" }}</td>
            <td class="col-2">{{ getDateString(prescription.createdAt) }}</td>
          </tr>
          }</ng-container
        >
      </tbody>
    </table>
    } @if(isLoading){
    <div class="mx-auto pe-5 mt-5" style="width: fit-content"><mat-spinner></mat-spinner></div>
    }
  </div>

  <!-- If one prescription is selected:display result -->
  @if (selectedPrescription) {
  <!-- Print a single line displaying Prescription id | Date | Patient name | doctor name And Deselect Button -->
  <div class="d-flex gap-2 justify-content-center" style="height: 2rem">
    <p class="align-self-center m-0">Selected Prescription :</p>
    <span class="text-primary fw-bold align-self-center"> Id : {{ selectedPrescription.id.slice(-10) + "..." }} | {{selectedRegister?.patient?.firstName}} {{selectedRegister?.patient?.lastName}} {{  getAge(selectedRegister?.patient?.dateOfBirth) }}</span>
    <mat-icon class="align-self-center" (click)="onClickDeselectPrescription()">close</mat-icon>
  </div>
  <!-- Display Prescription details component -->
  <div>Prescription Details here (TODO)</div>
  }
</div>
