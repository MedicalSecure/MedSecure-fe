<div class="table-responsive mt-1">
  <table
    mat-table
    [dataSource]="dataSource"
    multiTemplateDataRows
    matSort
    class="custom-table"
  >
    <ng-container matColumnDef="header">
      <div class="date" style="display: flex; align-items: flex-start">
        <th
          mat-header-cell
          *matHeaderCellDef
          [attr.colspan]="columnsToDisplay.length"
        >
          <mat-chip class="uc" style="margin-right: 20px">
            MedSecure: Prescription
          </mat-chip>

          <!-- <div class="form-group" style="width: 300px;  position: relative; border-radius: 50px;">
    <input style="width:300px; border-radius: 50px;" type="text" class="form-control rounded-input" (keyup)="Filter($event)" placeholder="Search...">
  </div> -->

          <mat-form-field
            appearance="outline"
            style="
              width: 300px;
              position: relative;
              border-radius: 50px;
              margin-top: 20px;
            "
          >
            <input
              style="width: 300px; border-radius: 50px"
              matInput
              (keyup)="Filter($event)"
              placeholder="Search..."
              #input
              style="width: 200px; color: gray"
            />
          </mat-form-field>

          <mat-form-field
            appearance="outline"
            style="
              position: relative;
              margin-left: 10px;
              width: 300px;
              background-color: transparent;
              color: transparent;
              border-color: transparent;
            "
          >
            <mat-label>Choose a date</mat-label>
            <input
              matInput
              [matDatepicker]="picker"
              #dateInput
              (dateChange)="changeDate(dateInput.value)"
            />
            <mat-datepicker-toggle
              matIconSuffix
              [for]="picker"
            ></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>

          <button
            style="
              background-color: transparent;
              border-color: transparent;
            "
            (click)="onLeftButtonClick()"
          >
            <img src="assets/left_arrow_icon.svg" alt="left_arrow" />
          </button>
          {{ selectedDate.toISOString().slice(0,selectedDate.toISOString().indexOf('T')) }}
          <button
            style="
              background-color: transparent;
              border-color: transparent;
            "
            (click)="onRightButtonClick()"
          >
            <img src="assets/right_arrow_icon.svg" alt="right_arrow" />
          </button>
        </th>
      </div>
      <tr mat-header-row *matHeaderRowDef="['header']"></tr>
    </ng-container>

    <!-- Position Column -->
    <ng-container matColumnDef="mrn">
      <th mat-header-cell *matHeaderCellDef>
        Medical Record Number (MRN)
      </th>
      <td mat-cell *matCellDef="let element">{{ element.id }}</td>
    </ng-container>

    <!-- Name Column -->
    <ng-container matColumnDef="patient_fullName">
      <th mat-header-cell *matHeaderCellDef>Name</th>
      <td mat-cell *matCellDef="let element">{{ element.patient_fullName }}</td>
    </ng-container>

    <!-- age Column -->
    <ng-container matColumnDef="patient_dateOfBirth">
      <th mat-header-cell *matHeaderCellDef>Date of Birth</th>
      <td mat-cell *matCellDef="let element">
        {{ element.patient_dateOfBirth | date : "yyyy-MM-dd" }}
        <strong> ({{calculateAge(element.patient_dateOfBirth)}}</strong> years
        old)
      </td>
    </ng-container>

    <!-- registerDate Column -->
    <ng-container matColumnDef="registeredAt">
      <th mat-header-cell *matHeaderCellDef>Register Date</th>
      <td mat-cell *matCellDef="let element">
        {{ element.createdAt | date : "yyyy-MM-dd - HH:MM" }}
      </td>
    </ng-container>

    <!-- status Column -->
    <ng-container matColumnDef="currentStatus">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
      <td mat-cell *matCellDef="let element">
        @if ( element.currentStatus === 1) {
        <mat-chip class="element mat-chip" style="background-color: rgba(255, 0, 0, 0.05); border: 1px solid red">Out</mat-chip>
        } @else if (element.currentStatus === 0) {
        <mat-chip class="element mat-chip" style="background-color: rgba(17, 255, 33, 0.05); border: 1px solid green">Resident</mat-chip>
        }@else if (element.currentStatus === 2) {
          <mat-chip class="element mat-chip" style="background-color: rgba(195, 207, 26, 0.05); border: 1px solid rgb(255, 208, 0)">Registered</mat-chip>
          }
      </td>
    </ng-container>

    <!-- details Column -->
    <ng-container matColumnDef="patient_id">
      <th mat-header-cell *matHeaderCellDef mat-sort-header > Action</th>
      <td mat-cell *matCellDef="let element" class="element">
        <i class="fa fa-address-card-o" matTooltip="Look details"></i>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: columnsToDisplay"
      (click)="onClickPatient(row)"
    ></tr>
        <!-- (click)="onRowClick" -->
    <!-- Row shown when there is no matching data. BUT NOT LOADING-->
    <tr class="mat-row" *matNoDataRow>
      <td *ngIf="RegistrationsList.length > 0 && !IsPatientListLoading" class="mat-cell pt-2" colspan="6">No data matching the filter</td>
      <td *ngIf="RegistrationsList.length == 0 && !IsPatientListLoading" class="mat-cell pt-2" colspan="6">{{ErrorMessage}}</td>
    </tr>

  </table>
  <!-- shown when LOADING-->
  <ng-container *ngIf="IsPatientListLoading">
    <div class="mx-auto px-auto my-4" style="width: fit-content;" >
      <mat-spinner  />
    </div>
  </ng-container>
</div>