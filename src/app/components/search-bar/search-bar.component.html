<div [className]="containerClasses" style="min-height: 4.5rem;">
  @if(!(hideSearchIfMaximumReached && hasReachedLimit)){
  <div class="search d-flex flex-column justify-content-center" style="min-width: 20rem">
    <div class="position-relative mt-1">
      <input
        type="text"
        placeholder="Search for medication"
        [formControl]="searchControl"
        [matAutocomplete]="auto"
        class="form-control shadow-sm"
        style="border-color: rgb(238, 238, 238); height: 2.6rem"
        [disabled]="selectedSearchTerm == undefined || selectedSearchTerm == null"
      />
      <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
        <ng-container *ngFor="let medication of filteredMedications | async" class="d-flex align-items-center">
          <mat-option (onSelectionChange)="onChangeSelectedMedication(medication)" class="result">
            {{ getMedicationProperty(medication) }}
          </mat-option>
        </ng-container>
      </mat-autocomplete>
      <button mat-icon-button matSuffix class="position-absolute top-50 bg-transparent" style="right: 5px; transform: translateY(-41%); border: none">
        <mat-icon>search</mat-icon>
      </button>
    </div>
  </div>

  <div style="width: fit-content" class="d-flex align-items-center">
    <mat-chip-listbox [value]="selectedSearchTerm" (change)="onSearchKeySelectionChange($event)" >
      @for(searchTerm of searchTerms;track $index){
        <mat-chip-option [value]="searchTerm">{{ searchTerm.label }}</mat-chip-option>
      }
    </mat-chip-listbox>
  </div>  
  }

  @if (displaySelectedMedication && selectedMedications.length > 0) {
  <div class="border border-black p-2 mt-1 position-relative align-self-start">
  <p class="position-absolute px-2 bg-white fit-content" style="z-index: 2; top: -0.8em; left: 1em">Selected medication{{ selectedMedications.length > 1 ? "s" : "" }}:</p>
    <div *ngFor="let medication of selectedMedications; let index = index" class="medication-item">
      <div  class="d-flex gap-3 mt-1 align-middle justify-content-start align-items-center   ">
        <p class="d-flex gap-3 mt-1 align-middle align-items-center">
          <img
            width="30"
            height="30"
            src="https://img.icons8.com/external-konkapp-flat-konkapp/64/external-syringe-emergency-services-konkapp-flat-konkapp.png"
            alt="external-syringe-emergency-services-konkapp-flat-konkapp"
          />

          <strong>{{ medication.name }}</strong>
          <strong>{{ medication.dosage }}</strong>
          <strong>{{ medication.unit }}</strong>
          <strong>{{ medication.code }}</strong>
          <strong>{{ medication.stock }}</strong>
          <img
            src="assets/images/info.svg"
            alt="info"
            style="height: 15px; width: 15px; margin-top: 3px"
            matTooltip="
                Indications: {{ medication.description }}
                "
          />
        </p>
        <i class="fa fa-times-circle clickable" aria-hidden="true" (click)="removeMedication(medication,index)"></i>

      </div>
    </div>
  </div>
  }
</div>
